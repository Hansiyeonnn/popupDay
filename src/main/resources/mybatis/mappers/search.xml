<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="flower.popupday.search.dao.SearchDAO">
    <!-- 팝업 정보 결과 매핑 -->
    <resultMap type="flower.popupday.popup.dto.PopupDTO" id="PopupResult">
        <result property="popup_id" column="popup_id"/>
        <result property="title" column="title"/>
        <result property="info" column="info"/>
        <result property="start_date" column="start_date"/>
        <result property="end_date" column="end_date"/>
        <result property="content" column="content"/>
        <result property="address" column="address"/>
        <result property="brand_page" column="brand_page"/>
        <result property="role" column="role"/>
        <result property="user_id" column="user_id"/>
        <result property="created_date" column="created_date"/>
        <result property="hits" column="hits"/>
        <result property="monday_time" column="monday_time"/>
        <result property="tuesday_time" column="tuesday_time"/>
        <result property="wednesday_time" column="wednesday_time"/>
        <result property="thursday_time" column="thursday_time"/>
        <result property="friday_time" column="friday_time"/>
        <result property="saturday_time" column="saturday_time"/>
        <result property="sunday_time" column="sunday_time"/>
    </resultMap>

    <!-- 해시태그로 팝업 검색 -->
    <select id="searchPopupsByHashTag" resultMap="PopupResult" parameterType="string">
        SELECT p.*
        FROM popup_tbl p
                 JOIN popup_hash_tag_tbl pht ON p.popup_id = pht.popup_id
                 JOIN hash_tag_tbl ht ON pht.hash_tag_id = ht.hash_tag_id
        WHERE ht.hash_tag LIKE CONCAT('%', #{query}, '%')
    </select>

    <!-- 단어 검색시 조회 -->
    <select id="searchPopupsByWord" resultMap="PopupResult" parameterType="string">
        SELECT * FROM popup_tbl
        WHERE title LIKE CONCAT('%', #{keyword}, '%')
           OR info LIKE CONCAT('%', #{keyword}, '%')
           OR content LIKE CONCAT('%', #{keyword}, '%')
           OR address LIKE CONCAT('%', #{keyword}, '%')
           OR brand_page LIKE CONCAT('%', #{keyword}, '%')
    </select>

    <!-- 날짜로 팝업 검색 -->
    <select id="searchPopupsByDate" resultMap="PopupResult" parameterType="java.sql.Date">
        <![CDATA[
        SELECT * FROM popup_tbl
        WHERE start_date <= #{selectedDate} AND end_date >= #{selectedDate}
        ]]>
    </select>
</mapper>
